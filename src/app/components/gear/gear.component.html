<form class="gear-container" #optionsFOrm="ngForm">
    <mat-form-field class="option-container">
        <input matInput placeholder="Title" [(ngModel)]="options.title" name="Title" required="false">
    </mat-form-field>

    <mat-toolbar class="subheader" color="primary">
        <span>Required Config</span>
    </mat-toolbar>

    <div *ngIf=!options.isMultiLayerWidget>

        <mat-form-field class="option-container">
            <mat-select placeholder="Database" [(ngModel)]="options.database" required="true" name="database"
                (ngModelChange)="handleChangeDatabase(options)" [disabled]="options.databases.length < 2">
                <mat-option *ngFor="let database of options.databases" [value]="database">{{ database.prettyName }}</mat-option>
            </mat-select>
        </mat-form-field>

        <mat-form-field class="option-container">
            <mat-select placeholder="Table" [(ngModel)]="options.table" required="true" name="table" (ngModelChange)="handleChangeTable(options)"
                [disabled]="options.tables.length < 2">
                <mat-option *ngFor="let table of options.tables" [value]="table">{{ table.prettyName }}</mat-option>
            </mat-select>
        </mat-form-field>
    </div>

    <!-- MultiLayer Support-->
    <div class="list-container" *ngIf="options.isMultiLayerWidget">

        <a class="icon-with-text tappable" (click)="addLayer()">
            <mat-icon class="neon-icon-small">add_circle</mat-icon>
            <div>Add Layer</div>
        </a>

        <div *ngFor="let layer of options.layers">
            <mat-toolbar class="subheader" style="cursor: pointer;" (click)="toggleFilter(layer)">
                <span>{{ layer.title }}</span>
                <span class="toolbar-spacer"></span>
                <mat-icon class="neon-icon-small" *ngIf="options.layers.length > 1" (click)="removeLayer(layer)">delete</mat-icon>
                <mat-icon class="neon-icon-small">{{ getIconForFilter(layer) }}</mat-icon>
            </mat-toolbar>
            <div class="option-well" [hidden]="layerVisible.get(layer._id)">
                <app-options-list [databases]=options.databases [fields]=options.fields [tables]=options.tables
                    [optionsList]=getLayerList(layer) [handleChangeData]=handleChangeData [handleChangeDatabase]=handleChangeDatabase
                    [handleChangeLimit]=handleChangeLimit [handleChangeFilterField]=handleChangeFilterField
                    [handleChangeSubcomponentType]=handleChangeSubcomponentType [handleChangeTable]=handleChangeTable
                    [handleDataChange]=handleDataChange.bind(this)>
                </app-options-list>
            </div>
        </div>
    </div>

    <!-- Non MultiLayer Support-->
    <div class="list-container">

        <!-- Required Options-->
        <app-options-list [databases]=options.databases [fields]=options.fields [tables]=options.tables [optionsList]=requiredList
            [handleChangeData]=handleChangeData [handleChangeDatabase]=handleChangeDatabase [handleChangeLimit]=handleChangeLimit
            [handleChangeFilterField]=handleChangeFilterField [handleChangeSubcomponentType]=handleChangeSubcomponentType
            [handleChangeTable]=handleChangeTable [handleDataChange]=handleDataChange.bind(this)>
        </app-options-list>

        <app-options-list [databases]=options.databases [fields]=options.fields [tables]=options.tables [optionsList]=requiredListNonField
            [handleChangeData]=handleChangeData [handleChangeDatabase]=handleChangeDatabase [handleChangeLimit]=handleChangeLimit
            [handleChangeFilterField]=handleChangeFilterField [handleChangeSubcomponentType]=handleChangeSubcomponentType
            [handleChangeTable]=handleChangeTable [handleDataChange]=handleDataChange.bind(this)>
        </app-options-list>

        <!-- Optional Options-->
        <mat-toolbar class="subheader" style="cursor: pointer;" (click)="toggleOptionalOptions()" color="primary">
            <span>Optional Config</span>
            <mat-icon class="neon-icon-small">{{ getIconForOptions() }}</mat-icon>
        </mat-toolbar>
        <div [hidden]="collapseOptionalOptions">
            <app-options-list [databases]=options.databases [fields]=options.fields [tables]=options.tables [optionsList]=optionalList
                [handleChangeData]=handleChangeData [handleChangeDatabase]=handleChangeDatabase [handleChangeLimit]=handleChangeLimit
                [handleChangeFilterField]=handleChangeFilterField [handleChangeSubcomponentType]=handleChangeSubcomponentType
                [handleChangeTable]=handleChangeTable [handleDataChange]=handleDataChange.bind(this)>
            </app-options-list>

            <app-options-list [databases]=options.databases [fields]=options.fields [tables]=options.tables [optionsList]=optionalListNonField
                [handleChangeData]=handleChangeData [handleChangeDatabase]=handleChangeDatabase [handleChangeLimit]=handleChangeLimit
                [handleChangeFilterField]=handleChangeFilterField [handleChangeSubcomponentType]=handleChangeSubcomponentType
                [handleChangeTable]=handleChangeTable [handleDataChange]=handleDataChange.bind(this)>
            </app-options-list>
        </div>
    </div>

    <app-export-control [widgets]="componentThis"></app-export-control>
</form>

<div class="button-footer" align="right">
    <button mat-raised-button class="neon-button-large" color="primary" (click)="resetChangeList()">
        Cancel
    </button>
    <button mat-raised-button class="neon-button-large" color="primary" [disabled]="changeList.length == 0" (click)="handleApplyClick()">
        Apply Changes
    </button>
</div>
